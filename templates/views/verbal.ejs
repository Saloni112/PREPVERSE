<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Placement Prep - Verbal Ability</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
       :root {
            --primary: #1070AE;
            --primary-light: #439FC8;
            --primary-dark: #05243B;
            --secondary: #064471;
            --light: #F3EDE1;
            --dark: #05243B;
            --darker: #041A2E;
            --gray: #7e7e7e;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
        }

        body {
            background: #05243B;
            color: #F3EDE1;
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
        }

        /* Navbar Styling */
        .top-nav {
            background-color: var(--primary-dark);
            color: white;
            padding: 0.8rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 600;
            color: white;
            text-decoration: none;
        }

        .logo img {
            width: 40px;
            margin-right: 10px;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            gap: 1.5rem;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.6) !important;
            text-decoration: none;
            padding: 0.5rem 0;
            position: relative;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .nav-link.active {
            color: white !important;
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--primary-light);
            border-radius: 3px 3px 0 0;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }

        .logout-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .logout-btn:hover {
            background-color: var(--primary-light);
        }

        .info-box {
            background: linear-gradient(135deg, var(--secondary), var(--primary-dark));
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .aptitude-heading {
            color: var(--light);
            margin: 2rem 0;
        }
        
        .aptitude-card {
            background: linear-gradient(135deg, var(--secondary), var(--primary-dark));
            border: 1px solid var(--primary-light);
            border-radius: 12px;
            color: var(--light);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .aptitude-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .aptitude-card .card-body {
            padding: 1.5rem;
        }
        
        .aptitude-card .icon {
            display: inline-block;
            padding: 15px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .btn-outline-primary {
            color: var(--primary-light);
            border-color: var(--primary-light);
        }
        
        .btn-outline-primary:hover {
            background-color: var(--primary-light);
            border-color: var(--primary-light);
            color: var(--dark);
        }
        
        .text-theme-secondary {
            color: var(--primary-light) !important;
        }

        /* Question Container Styles */
        .question-container {
            background: linear-gradient(135deg, var(--secondary), var(--primary-dark));
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .question-card {
            color: var(--light);
        }

        .question-text {
            color: var(--light);
            font-weight: 500;
            line-height: 1.6;
            font-size: 1.2rem;
        }

        /* Options Styles */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            margin: 2rem 0;
        }

        .option-item {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .option-item:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--primary-light);
        }

        .option-item.selected {
            background: rgba(16, 112, 174, 0.3);
            border-color: var(--primary-light);
        }

        .option-item.correct {
            background: rgba(40, 167, 69, 0.3);
            border-color: var(--success);
        }

        .option-item.incorrect {
            background: rgba(220, 53, 69, 0.3);
            border-color: var(--danger);
        }

        .option-letter {
            background: var(--primary);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
        }

        .option-text {
            flex: 1;
            color: var(--light);
            font-size: 1.1rem;
        }

        /* Progress Bar */
        .progress-container {
            background: var(--darker);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 2rem;
        }

        .progress {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
        }

        .progress-bar {
            background: var(--primary-light);
            transition: width 0.3s ease;
        }

        /* Explanation Card */
        .explanation-card {
            border-radius: 8px;
            animation: fadeIn 0.5s ease;
            margin-top: 1.5rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Topic Cards */
        .qa-topic-card {
            background: linear-gradient(135deg, var(--secondary), var(--primary-dark)) !important;
            border: 1px solid var(--primary-light) !important;
            color: var(--light) !important;
            transition: all 0.3s ease !important;
            cursor: pointer;
        }

        .qa-topic-card:hover {
            transform: translateY(-5px) !important;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3) !important;
            border-color: var(--primary) !important;
        }

        .qa-topic-icon {
            font-size: 2rem;
            color: var(--primary-light);
            margin-bottom: 0.5rem;
        }

        .qa-topic-title {
            font-weight: 600;
            color: var(--light);
            font-size: 1.1rem;
        }

        .difficulty-badge {
            font-size: 0.8rem;
            padding: 0.3rem 0.8rem;
        }

        /* New Styles for Enhanced Features */
        .topic-progress {
            font-size: 0.8rem;
            color: var(--primary-light);
            margin-top: 0.5rem;
        }

        .completion-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--success);
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .timer-container {
            background: var(--darker);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            margin-bottom: 1rem;
        }

        .topic-stats {
            font-size: 0.9rem;
            color: var(--primary-light);
        }

        /* Verbal-specific styles */
        .passage-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .passage-text {
            line-height: 1.8;
            font-size: 1.1rem;
        }

        .vocabulary-hint {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-style: italic;
        }
    </style>
</head> 
<body>
    <!-- Navigation -->
    <nav class="top-nav">
        <div class="nav-container">
            <a href="#" class="logo">
                <img src="/images/logo.png" alt="PrepVerse Logo">
                PrepVerse
            </a>
            <ul class="nav-menu" id="navMenu" style="margin-right: 150px;">
                <li><a href="/aptitude" class="nav-link">Home</a></li>
                <li><a href="/quant" class="nav-link">Quant</a></li>
                <li><a href="/reasoning" class="nav-link">Reasoning</a></li>
                <li><a href="/verbal" class="nav-link active">Verbal</a></li>
                <li><a href="/sdashboard" class="nav-link "><i class="fas fa-home"></i> Dashboard</a></li>

            </ul>
            
            <div class="user-actions" id="userActions">
                <div class="user-profile">
                </div>
            </div>
        </div>
    </nav>

    <div class="main-bg min-vh-100 py-5">
        <div class="container">
            <!-- Hero Section -->
            <div class="text-center mb-5">
                <div class="display-4 mb-2" style="color:#1070AE;">
                    <i class="fa-solid fa-language"></i>
                </div>
                <h1 class="fw-bold" style="color: #e6e6e6;">Verbal Ability</h1>
                <p class="lead" style="color:#439FC8;">
                    "Words are, in my not-so-humble opinion, our most inexhaustible source of magic." <br>
                    <span class="fst-italic" style="color:#064471;">â€“ J.K. Rowling</span>
                </p>
            </div>

            <!-- Motivational Quote -->
            <div class="alert alert-info text-center mb-4" style="background:#1070AE;color:#fff;border:none;">
                <i class="fa-solid fa-lightbulb me-2"></i>
                Strengthen your communication skills with these essential verbal topics!
            </div>

            <!-- Timer Section -->
            <div id="timerSection" class="timer-container text-center" style="display: none;">
                <span class="fw-bold text-theme-secondary">
                    <i class="fas fa-clock me-2"></i>
                    Time: <span id="timer">00:00</span>
                </span>
            </div>

            <!-- Progress Section (Initially Hidden) -->
            <div id="progressSection" class="progress-container" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span id="scoreText" class="fw-bold text-theme-secondary">Score: 0/0</span>
                    <span id="progressText" class="text-muted">0/0</span>
                </div>
                <div class="progress">
                    <div id="progressBar" class="progress-bar" style="width: 0%"></div>
                </div>
            </div>

            <!-- Question Container -->
            <div id="questionContainer" class="question-container">
                <div class="text-center py-5">
                    <h4>Select a topic to start practicing!</h4>
                    <p class="text-muted">Choose from the topics below to begin your verbal practice.</p>
                </div>
            </div>

            <!-- Topics Grid -->
            <div class="d-flex flex-row flex-nowrap overflow-auto qa-topic-badges mb-4 gap-3 px-1">
                <a href="javascript:void(0)" onclick="loadTopic('reading-comprehension')" class="text-decoration-none text-reset">
                    <div class="card text-center shadow-sm qa-topic-card position-relative" style="min-width:210px; max-width:210px; min-height:180px; max-height:180px;">
                        <div class="card-body py-3 d-flex flex-column justify-content-center align-items-center" style="height:140px;">
                            <span class="qa-topic-icon"><i class="fa-solid fa-book-open-reader"></i></span>
                            <div class="qa-topic-title mt-2">Reading Comprehension</div>
                        </div>
                    </div>
                </a>
                <a href="javascript:void(0)" onclick="loadTopic('para-jumbles')" class="text-decoration-none text-reset">
                    <div class="card text-center shadow-sm qa-topic-card position-relative" style="min-width:210px; max-width:210px; min-height:180px; max-height:180px;">
                        <div class="card-body py-3 d-flex flex-column justify-content-center align-items-center" style="height:140px;">
                            <span class="qa-topic-icon"><i class="fa-solid fa-align-left"></i></span>
                            <div class="qa-topic-title mt-2">Para Jumbles</div>
                        </div>
                    </div>
                </a>
                <a href="javascript:void(0)" onclick="loadTopic('vocabulary')" class="text-decoration-none text-reset">
                    <div class="card text-center shadow-sm qa-topic-card position-relative" style="min-width:210px; max-width:210px; min-height:180px; max-height:180px;">
                        <div class="card-body py-3 d-flex flex-column justify-content-center align-items-center" style="height:140px;">
                            <span class="qa-topic-icon"><i class="fa-solid fa-spell-check"></i></span>
                            <div class="qa-topic-title mt-2">Vocabulary</div>
                        </div>
                    </div>
                </a>
                <a href="javascript:void(0)" onclick="loadTopic('grammar')" class="text-decoration-none text-reset">
                    <div class="card text-center shadow-sm qa-topic-card position-relative" style="min-width:210px; max-width:210px; min-height:180px; max-height:180px;">
                        <div class="card-body py-3 d-flex flex-column justify-content-center align-items-center" style="height:140px;">
                            <span class="qa-topic-icon"><i class="fa-solid fa-pen-nib"></i></span>
                            <div class="qa-topic-title mt-2">Grammar</div>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentTopic = '';
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userScore = 0;
        let selectedOptionIndex = -1;
        let timerInterval;
        let timeSpent = 0;
        let userProgress = {};

        // Function to load questions for a topic
        async function loadTopic(topicSlug) {
            try {
                showLoading();
                console.log(`Loading topic: ${topicSlug}`);
                
                // Try multiple API endpoint variations
                const endpoints = [
                    `/api/questions/topic/${topicSlug}`,
                    `/api/questions/verbal/${topicSlug}`,
                    `/api/verbal/questions/${topicSlug}`,
                    `/api/questions?topic=${topicSlug}&category=verbal`
                ];

                let response = null;
                let data = null;

                // Try each endpoint until one works
                for (const endpoint of endpoints) {
                    try {
                        console.log(`Trying endpoint: ${endpoint}`);
                        response = await fetch(endpoint);
                        
                        if (response.ok) {
                            data = await response.json();
                            console.log('Success with endpoint:', endpoint);
                            console.log('API Response:', data);
                            break;
                        }
                    } catch (err) {
                        console.log(`Failed with endpoint ${endpoint}:`, err.message);
                        continue;
                    }
                }

                if (!response || !response.ok) {
                    throw new Error(`All endpoints failed. Last status: ${response ? response.status : 'No response'}`);
                }

                // Handle different response structures
                if (data.questions) {
                    currentQuestions = data.questions;
                } else if (Array.isArray(data)) {
                    currentQuestions = data;
                } else if (data.data && Array.isArray(data.data)) {
                    currentQuestions = data.data;
                } else {
                    throw new Error('Invalid response format: questions array not found');
                }

                currentTopic = topicSlug;
                currentQuestionIndex = 0;
                userScore = 0;
                selectedOptionIndex = -1;
                timeSpent = 0;
                
                if (currentQuestions.length === 0) {
                    document.getElementById('questionContainer').innerHTML = `
                        <div class="alert alert-warning text-center">
                            <h4>No questions available</h4>
                            <p>No questions found for ${topicSlug}. Please try another topic.</p>
                            <button class="btn btn-primary mt-2" onclick="showTopics()">Back to Topics</button>
                        </div>
                    `;
                    hideLoading();
                    return;
                }

                // Show progress and timer sections
                document.getElementById('progressSection').style.display = 'block';
                document.getElementById('timerSection').style.display = 'block';
                
                // Start timer
                startTimer();
                
                showQuestion();
                updateProgress();
                
            } catch (error) {
                console.error('Error loading questions:', error);
                document.getElementById('questionContainer').innerHTML = `
                    <div class="alert alert-danger text-center">
                        <h4>Error Loading Questions</h4>
                        <p>${error.message}</p>
                        <div class="mt-3">
                            <button class="btn btn-primary me-2" onclick="loadTopic('${topicSlug}')">Retry</button>
                            <button class="btn btn-outline-primary" onclick="showTopics()">Back to Topics</button>
                        </div>
                    </div>
                `;
                hideLoading();
            }
        }

        // Timer functions
        function startTimer() {
            clearInterval(timerInterval);
            timeSpent = 0;
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeSpent++;
                updateTimerDisplay();
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeSpent / 60);
            const seconds = timeSpent % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Function to display current question
        function showQuestion() {
            if (currentQuestions.length === 0) {
                document.getElementById('questionContainer').innerHTML = `
                    <div class="alert alert-info text-center">
                        <h4>No questions available for this topic</h4>
                        <p>Please check back later or try another topic.</p>
                    </div>
                `;
                hideLoading();
                return;
            }

            const question = currentQuestions[currentQuestionIndex];
            console.log('Displaying question:', question);

            // Validate question structure
            if (!question.question || !question.options || !Array.isArray(question.options)) {
                console.error('Invalid question structure:', question);
                document.getElementById('questionContainer').innerHTML = `
                    <div class="alert alert-danger text-center">
                        <h4>Invalid Question Format</h4>
                        <p>The question data is not in the expected format.</p>
                        <button class="btn btn-primary mt-2" onclick="nextQuestion()">Skip Question</button>
                    </div>
                `;
                hideLoading();
                return;
            }
            
            // Add verbal-specific content based on topic
            let verbalContent = '';
            if (currentTopic.includes('comprehension') && question.passage) {
                verbalContent = `
                    <div class="passage-container">
                        <h5 class="mb-3"><i class="fas fa-book me-2"></i>Read the following passage:</h5>
                        <div class="passage-text">
                            ${question.passage}
                        </div>
                    </div>
                `;
            } else if (currentTopic.includes('vocabulary')) {
                verbalContent = `
                    <div class="vocabulary-hint">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Tip:</strong> Consider the context and root words to determine the meaning.
                    </div>
                `;
            } else if (currentTopic.includes('grammar')) {
                verbalContent = `
                    <div class="vocabulary-hint">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Tip:</strong> Pay attention to subject-verb agreement and tense consistency.
                    </div>
                `;
            }
            
            const questionHTML = `
                <div class="question-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="badge difficulty-badge bg-${getDifficultyBadge(question.difficulty)}">
                            ${question.difficulty ? question.difficulty.toUpperCase() : 'MEDIUM'}
                        </span>
                        <span class="text-muted">Question ${currentQuestionIndex + 1} of ${currentQuestions.length}</span>
                    </div>
                    
                    ${verbalContent}
                    
                    <h4 class="question-text mb-4">${question.question}</h4>
                    
                    <div class="options-container">
                        ${question.options.map((option, index) => `
                            <div class="option-item" onclick="selectOption(${index})" id="option-${index}">
                                <span class="option-letter">${String.fromCharCode(65 + index)}</span>
                                <span class="option-text">${option}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="mt-4 d-flex justify-content-between">
                        <button class="btn btn-outline-secondary" onclick="previousQuestion()" 
                            ${currentQuestionIndex === 0 ? 'disabled' : ''}>
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn btn-primary" onclick="checkAnswer()" id="submitBtn">
                            Submit Answer
                        </button>
                        <button class="btn btn-outline-primary" onclick="nextQuestion()" 
                            ${currentQuestionIndex === currentQuestions.length - 1 ? 'disabled' : ''}>
                            Next <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('questionContainer').innerHTML = questionHTML;
            resetOptionSelection();
            hideLoading();
        }

        // Function to select an option
        function selectOption(optionIndex) {
            resetOptionSelection();
            selectedOptionIndex = optionIndex;
            const optionElement = document.getElementById(`option-${optionIndex}`);
            optionElement.classList.add('selected');
        }

        // Function to reset option selection
        function resetOptionSelection() {
            document.querySelectorAll('.option-item').forEach(option => {
                option.classList.remove('selected');
            });
            selectedOptionIndex = -1;
        }

        // Function to check answer
        function checkAnswer() {
            if (selectedOptionIndex === -1) {
                alert('Please select an answer!');
                return;
            }

            const question = currentQuestions[currentQuestionIndex];
            
            // Handle different answer field names
            const correctAnswer = question.answer || question.correctAnswer || question.correct_option;
            const userAnswer = question.options[selectedOptionIndex];
            
            const isCorrect = userAnswer === correctAnswer;

            // Show result
            showAnswerResult(isCorrect, question);
            
            // Update score
            if (isCorrect) {
                userScore++;
            }
            
            // Save progress
            saveProgress(currentTopic, currentQuestionIndex, isCorrect);
            
            updateProgress();
        }

        // Function to save progress
        function saveProgress(topic, questionIndex, isCorrect) {
            if (!userProgress[topic]) {
                userProgress[topic] = {
                    completed: 0,
                    correct: 0,
                    total: currentQuestions.length
                };
            }
            
            userProgress[topic].completed = Math.max(userProgress[topic].completed, questionIndex + 1);
            if (isCorrect) {
                userProgress[topic].correct++;
            }
            
            // Update topic progress display
            updateTopicProgress();
            
            // Save to localStorage
            localStorage.setItem('verbalProgress', JSON.stringify(userProgress));
        }

        // Function to update topic progress display
        function updateTopicProgress() {
            document.querySelectorAll('.topic-progress').forEach(element => {
                const topicName = element.closest('.qa-topic-card').querySelector('.qa-topic-title').textContent.toLowerCase().replace(' ', '-');
                if (userProgress[topicName]) {
                    element.textContent = `${userProgress[topicName].completed}/${userProgress[topicName].total} completed`;
                }
            });
        }

        // Function to show answer result
        function showAnswerResult(isCorrect, question) {
            const options = document.querySelectorAll('.option-item');
            
            // Handle different answer field names
            const correctAnswer = question.answer || question.correctAnswer || question.correct_option;
            
            options.forEach((option, index) => {
                option.style.pointerEvents = 'none'; // Disable further clicks
                
                if (question.options[index] === correctAnswer) {
                    option.classList.add('correct');
                } else if (index === selectedOptionIndex && !isCorrect) {
                    option.classList.add('incorrect');
                }
            });

            // Handle different explanation field names
            const explanation = question.explanation || question.solution || 'No explanation available.';
            
            // Show explanation
            const explanationHTML = `
                <div class="explanation-card ${isCorrect ? 'bg-success' : 'bg-danger'} text-white">
                    <div class="card-body">
                        <h5><i class="fas ${isCorrect ? 'fa-check' : 'fa-times'} me-2"></i>
                            ${isCorrect ? 'Correct!' : 'Incorrect!'}
                        </h5>
                        <p class="mb-0"><strong>Explanation:</strong> ${explanation}</p>
                    </div>
                </div>
            `;
            
            document.getElementById('questionContainer').insertAdjacentHTML('beforeend', explanationHTML);
            
            // Update submit button
            document.getElementById('submitBtn').disabled = true;
        }

        // Function to navigate to next question
        function nextQuestion() {
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                selectedOptionIndex = -1;
                showQuestion();
            } else {
                // Quiz completed
                showQuizCompletion();
            }
        }

        // Function to navigate to previous question
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                selectedOptionIndex = -1;
                showQuestion();
            }
        }

        // Function to show quiz completion
        function showQuizCompletion() {
            stopTimer();
            const percentage = (userScore / currentQuestions.length) * 100;
            
            document.getElementById('questionContainer').innerHTML = `
                <div class="text-center py-5">
                    <div class="display-1 ${percentage >= 70 ? 'text-success' : percentage >= 50 ? 'text-warning' : 'text-danger'}">
                        <i class="fas ${percentage >= 70 ? 'fa-trophy' : percentage >= 50 ? 'fa-medal' : 'fa-flag'}"></i>
                    </div>
                    <h2 class="mb-3">Quiz Completed!</h2>
                    <div class="row justify-content-center">
                        <div class="col-md-6">
                            <div class="card aptitude-card">
                                <div class="card-body">
                                    <h4>Your Score: ${userScore}/${currentQuestions.length}</h4>
                                    <p>Percentage: ${percentage.toFixed(1)}%</p>
                                    <p>Time Taken: ${document.getElementById('timer').textContent}</p>
                                    <div class="mt-3">
                                        <button class="btn btn-primary me-2" onclick="loadTopic('${currentTopic}')">
                                            <i class="fas fa-redo"></i> Try Again
                                        </button>
                                        <button class="btn btn-outline-primary" onclick="showTopics()">
                                            <i class="fas fa-list"></i> Other Topics
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Function to show topics list
        function showTopics() {
            document.getElementById('progressSection').style.display = 'none';
            document.getElementById('timerSection').style.display = 'none';
            document.getElementById('questionContainer').innerHTML = `
                <div class="text-center py-5">
                    <h4>Select a topic to start practicing!</h4>
                    <p class="text-muted">Choose from the topics below to begin your verbal practice.</p>
                </div>
            `;
        }

        // Function to update progress
        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = 
                `${currentQuestionIndex + 1}/${currentQuestions.length}`;
            document.getElementById('scoreText').textContent = `Score: ${userScore}/${currentQuestions.length}`;
        }

        // Function to get difficulty badge class
        function getDifficultyBadge(difficulty) {
            if (!difficulty) return 'secondary';
            
            switch (difficulty.toLowerCase()) {
                case 'easy': return 'success';
                case 'medium': return 'warning';
                case 'hard': return 'danger';
                default: return 'secondary';
            }
        }

        // Loading functions
        function showLoading() {
            document.getElementById('questionContainer').innerHTML = `
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">Loading questions...</p>
                </div>
            `;
        }

        function hideLoading() {
            // Loading is hidden when content is shown
        }

        // Load user progress from localStorage
        function loadUserProgress() {
            const savedProgress = localStorage.getItem('verbalProgress');
            if (savedProgress) {
                userProgress = JSON.parse(savedProgress);
                updateTopicProgress();
            }
        }

        // Check if we're on a topic page from URL
        document.addEventListener('DOMContentLoaded', function() {
            loadUserProgress();
            
            const urlParams = new URLSearchParams(window.location.search);
            const topicSlug = urlParams.get('slug');
            
            if (topicSlug) {
                loadTopic(topicSlug);
            }
        });
    </script>
</body>
</html>